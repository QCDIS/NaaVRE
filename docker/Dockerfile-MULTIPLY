FROM jupyterhub/k8s-singleuser-sample:1.1.3-n248.h20c9028e

USER root

RUN apt-get update --allow-releaseinfo-change && apt-get -y install git unzip gcc g++

ADD start-jupyter.sh /usr/local/bin/start-jupyter.sh
ADD jupyterlab_vre-0.1.0-py3-none-any.whl /home/jovyan/jupyterlab_vre-0.1.0-py3-none-any.whl
COPY ./notebooks/ /home/jovyan/notebooks/

RUN chmod ugo+x /usr/local/bin/start-jupyter.sh

USER $NB_USER

RUN conda remove --force -y terminado && \
    python -m pip install --upgrade pip

RUN python3 -m pip install --quiet --no-cache-dir /home/jovyan/jupyterlab_vre-0.1.0-py3-none-any.whl && \
    jupyter serverextension enable --py jupyterlab_vre --user && \
    jupyter lab build --debug;


#===== Add MULTIPLY dependencies ======

#========= Install_environments =======
RUN git clone https://github.com/JorisTimmermans/Deploy_MULTIPLY.git
#RUN conda install -c conda-forge pdal python-pdal gdal
#RUN pip install -r MULTIPLY_pip_requirements.txt
#====================================
#========= multiply_modules =======
#RUN git clone https://github.com/JorisTimmermans/atmospheric_correction.git
#WORKDIR atmospheric_correction
#RUN python setup.py develop
#WORKDIR ../
#RUN rm -r atmospheric_correction
#
#RUN git clone https://github.com/JorisTimmermans/BRDF_descriptors.git
#WORKDIR BRDF_descriptors
#RUN python setup.py install
#WORKDIR ../
#RUN rm -r BRDF_descriptors
#
#RUN git clone https://github.com/JorisTimmermans/data-access.git
#WORKDIR data-access
#RUN python setup.py develop
#WORKDIR ../
#RUN rm -r data-access
#
#
#RUN git clone https://github.com/multiply-org/inference-engine.git
#WORKDIR inference-engine
#RUN python setup.py develop
#WORKDIR ../
#RUN rm -r inference-engine
#
#
#RUN git clone https://github.com/JorisTimmermans/multiply-core.git
#WORKDIR multiply-core
#RUN python setup.py develop
#WORKDIR ../
#RUN rm -r multiply-core
#
#
##RUN git clone https://github.com/multiply-org/kaska.git
##WORKDIR kaska
##RUN python setup.py develop
##WORKDIR ../
##RUN rm -r kaska
#
#
#RUN git clone https://github.com/multiply-org/KaFKA-InferenceEngine.git
#WORKDIR KaFKA-InferenceEngine
#RUN python setup.py develop
#WORKDIR ../
#RUN rm -r KaFKA-InferenceEngine
#
##
##RUN git clone https://github.com/multiply-org/MULTIPLYVisualisation.git
##WORKDIR MULTIPLYVisualisation
##RUN python setup.py develop
##WORKDIR ../
##RUN rm -r MULTIPLYVisualisation
#
#RUN git clone https://github.com/multiply-org/sar-pre-processing.git
#WORKDIR sar-pre-processing
#RUN python setup.py develop
#WORKDIR ../
#RUN rm -r sar-pre-processing
#
#RUN git clone https://github.com/JorisTimmermans/vm-support.git
#WORKDIR vm-support
#RUN python setup.py develop
#WORKDIR ../
#RUN rm -r vm-support
#
#RUN echo 'from multiply_data_access import DataAccessComponent' > test.py
#RUN #python test.py
#====================================



CMD ["/usr/local/bin/start-jupyter.sh"]